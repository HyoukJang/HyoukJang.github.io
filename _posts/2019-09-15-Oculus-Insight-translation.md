---
published: true
layout: post
title: 'Powered by AI : Oculus Insight 번역'
author: JH
categories: technology
tags: POLARIANT Oculus Facebook SLAM
open: true
---

Facebook AI 에서 공개한 블로그 포스트 중 2019년 08월 22일에 릴리즈한 [Powered by AI: Oculus Insight](https://ai.facebook.com/blog/powered-by-ai-oculus-insight/)를 번역한 글입니다.

본 블로그 포스트를 굳이 번역한 까닭은 자율주행차, 모바일 스마트폰 AR 앱 등에 쓰이던 SLAM 기술 예시 중 최근 Oculus Quest에 탑재된 Facebook의 Oculus Insight가 단연코 State-of-the-art라고 생각하기 때문입니다. 

지난 5년간 폴라리언트를 경영하면서 지속적으로 VR과 AR의 6자유도 경험을 제대로 구현하는 것은 그 자체로 가장 높은 수준의 기술적 요건들을 충족시켜야한다고 강조해왔습니다. 그 기술적 요건이라 함은 완전 무선 환경에서 컴퓨터 비전 기반 위치 추적을 서브 밀리미터 정확도와 정밀도로 60Hz의 이상의 저지연성(Low Latency)를 보장한다는 의미이고 이것을 가능케 하는 상용 하드웨어 시스템은 없었고, 있다 하더라도 엄청 고가의 시스템으로 구현해야 했기 때문에 정말 어려웠습니다.

지난 2017년 실제 Oculus 초청으로 4주간 페이스북 본사에서 폴라리언트 솔루션으로 미팅을 했을 때, 컴퓨터 비전 기반으로 완전한 6자유도 경험을 제공하는 시스템을 한창 빌드업하고 있었으며, 구체적인 태스크에 할당된 컴퓨터 비전 엔지니어만 100명이라는 소식을 들었습니다. 약 4년간 상상도 가지 않는 자본을 써가면서 DSP 칩까지 커스텀하여 시장에 디바이스까지 내놓았으니 어찌 살펴보지 아니할 수 있을까요? 아래부터 포스트 번역 전문입니다.

---

가상현실(VR)과 증강현실(AR) 경험의 잠재력을 극대화하기 위해 기술은 어떤 곳에서도 동작해야 합니다. 사람들이 살아가는 곳 뿐만이 아니라 실제 상황 속에 어떻게 움직이더라도. 우리가 처음으로 All-in-one이자 완벽한 무선 VR 게이밍 시스템인 [Oculus Quest](https://www.oculus.com/quest/?fbclid=IwAR0LroH-13ORQDWVjpDt5J6Bv9eGmLNN3um-53P-_RHxF7nyxbGA0lymvYc)를 개발했을 때, 정밀하고 정확하며 실제 상황에서 적용가능한(충분히 컴팩트하고 에너지 효율적인 스탠드얼론 헤드셋을 지원하는) 포지셔널 트래킹이 필요함을 인지하고 있었습니다.

작년 Oculus Connect 행사에서 Oculus Quest와 Rift S에도 적용가능한 최신의 기술이며 VR 기술에 AI 시스템을 깊게 적용한 Oculus Insight의 일부를 공개했습니다. Oculus Insight는 가장 처음으로 완벽히 무선을 지원하는 6 자유도(6-DoF)의 헤드셋과 컨트롤러를 지원하는 컨슈머향 AR/VR 디바이스입니다. 가장 아랫단 부터 만들어졌으며, 가장 최첨단의 컴퓨터 비전(CV, Computer Vision) 시스템과 visual-inertial SLAM의 스택을 보유하였습니다.


<div class="video-container"> 
    <iframe width="100%" src="https://www.youtube.com/embed/nrj3JE-NHMw" frameborder="0" allowfullscreen></iframe>
</div> 


Oculus Insigt는 VR에서 가장 실제적인 경험을 느끼도록 하기 위해 VR 내의 당신의 정밀한 무브먼트를 반영하기 위해서 매 밀리초마다 헤드셋과 컨트롤러의 정확한 실시간 위치를 계산합니다. 이는 이용자의 헤드셋 움직임을 트래킹하기 위해 SLAM을 이용하고 컨트롤러의 위치를 트래킹하기 위해 constellation tracking을 이용합니다.


**Visual-inertial SLAM을 이용한 실시간 맵 작성 및 위치 트래킹**

지난 몇 십년 간 SLAM 테크닉에 대해서 학술적 연구가 진행되어 왔습니다. 그러나 최근에서 야 비로소 자율주행 차 혹은 모바일 AR 앱 등 일반 컨슈머 향 제품에 적용되었습니다. Facebook은 전에 Single Camera와 IMU를 활용해서 스마트폰의 위치를 추적하고 콘텐츠를 실제 세계에 얹어 보여주는 [SLAM for AR mobile devices](https://ai.facebook.com/blog/slam-bringing-art-to-life-through-technology/)를 릴리즈한 바 있습니다. Oculus Insight는 본 라이브러리의 두번 째 세대이며, 두 개 이상의 IMU와 광각 카메라 그리고 헤드셋과 컨트롤러의 6 자유도 위치를 추적하기 위한 적외선 LED의 조합을 포함한 더 중요한 정보들을 내포하고 있습니다.

Oculus Insight 시스템은 주어진 실제 공간의 다른 물체들과 가상의 물체들을 맞추어 보여주기 위하여 맞춤형 하드웨어 아키텍쳐와 진일보한 컴퓨터 비전 알고리즘(Visual-inertial 매핑, 지역 인지(Place Recognition) Geometry Reconstruction 등)을 사용하고 있습니다. 이 놀라운 알고리즘 스택은 VR 기기의 위치를 핀포인트 하고 방의 기하학적 관점을 구분할 수 있으며 본 시스템에 의거해서 생성되고 지속적으로 업데이트되는 3차원 지도 상에서의 헤드셋과 컨트롤러의 위치를 추적하도록 만들어줍니다. 본 프로세스에 사용된 데이터는 Quest와 Rift S 하드웨어에 장착되어 있는 세 가지 종류의 센서로부터 제공됩니다.

1. 헤드셋 및 컨트롤러에있는 IMU의 선형 가속 및 회전 속도 데이터가 통합되어 지연 시간이 짧은 각 방향 및 위치를 추적합니다.
   
2. 헤드셋에 있는 카메라의 이미지 데이터는 방의 3D 맵을 생성하는 데 도움이되며 가구 모서리 또는 바닥의 패턴과 같은 랜드 마크를 정확하게 나타냅니다. 이러한 랜드 마크는 반복적으로 관찰되므로 Insight가 드리프트 (시간이 지남에 따라 작은 측정 불일치가 발생하여 위치 추적이 부정확 한 IMU의 일반적인 문제)를 보상 할 수 있습니다.

3. 컨트롤러의 적외선 LED는 헤드셋 카메라에 의해 감지되어 시스템이 여러 IMU를 통합하여 발생하는 컨트롤러 위치 드리프트를 보정합니다.

이동하면 Oculus Insight는 창의 모서리와 같이 대비가 높은 이미지의 픽셀을 감지합니다. 이러한 고 대비 이미지 영역은 이미지에서 이미지까지 시간이 지남에 따라 추적 및 연결됩니다. Oculus Insight는 관측 기준이 충분히 길면 주변 각 지점의 3D 위치를 삼각 측량 할 수 있습니다. 이것은 시스템의 3D 환경 맵의 기초를 형성합니다.

SLAM의 첫 번째 주요 응용 분야는 로봇 공학, 특히 초기 자율 주행 차량에서 대량의 컴퓨팅 리소스 (여러 온보드 PC)에 의존하고 값 비싼 (내비게이션 등급 IMU와 같은) 센서와 고전력을 요구하는 센서(예 : 3D Lidar 시스템)를 사용했습니다. 최근에는 엔지니어들이 게임 및 카메라 필터의 AR 효과를 위해 휴대폰에서도 SLAM을 실행할 수있는 기술을 도입했습니다.


그러나 모바일 스마트폰 AR에는 약간의 지연 또는 위치 부정확성이 허용되지만, 완전 무선의 VR은 소비자 SLAM 애플리케이션을 위해서 전례없는 수준의 속도, 정확성 및 정밀도를 요구합니다. 왜냐하면, 모바일 스마트폰 AR에서 3D 효과는 사용자의 전체 시야의 작은 영역을 차지하고 콘텐츠를 시간 동기화하여 대기 시간을 줄일 수 있는 반면, VR의 컨텐츠는 사용자의 전체 시야를 차지하므로 시스템은 사용자가 이동할 수있는 한 빨리 응답해야합니다. 이로 인해 잠재적 추적 오류가 훨씬 더 눈에 띄게되고 Oculus Quest and Rift에서 Insight를 실행하기가 훨씬 어려워집니다.

SLAM은 환경의 기능을 자동으로 인식하여 이러한 문제를 해결함으로써 Oculus Insight가 플레이어의 현재 위치를 VR 디스플레이에 통합 할 수 있도록 합니다. 또한 Insight는 다이나믹 댐핑 기능이있는 외삽 기능을 사용하여 사용자의 머리와 손이 밀리 초 단위로 어디로 이동할지 예측합니다. 이는 추적 시스템을 측정하는 주요 지표 인 지터 (Jitter)로 알려진 시각적 흔들림 효과를 줄이는 등 여러 가지 이점을 제공합니다. 편안한 VR 경험을 가능하게 하려면 추적 정확도는 1 밀리미터 미만의 범위 내에 있어야합니다. 즉, 시스템은 1 밀리미터보다 큰 정밀도로 추적 할 수 있습니다. Insight는 대부분의 환경에서 본 목표를 초과합니다. 

몰입형 경험을 제공 할 때 피해야 할 또 다른 주요 요소는 지연 시간(latency)입니다. 물리적 움직임과 그에 상응하는 VR 간의 지연은 사용자를 혼란스럽게하고 현실감을 떨어 뜨릴 수 있습니다. Insight는 대기 시간이 짧은 IMU 데이터와 사용자의 미래 움직임을 예측하는 운동학적 모델을 사용하여 명백한 대기 시간을 효과적으로 제거 할 수 있습니다. 다음 섹션에서는 SLAM 데이터를 통합하는 센서 퓨전 프로세스에 대해 자세히 설명할 예정입니다. 지터(jitter)와 대기 시간(latench)을 줄이는 것이 VR 내에서 새로운 수준의 사실감을 제공하는 Insight의 능력의 핵심입니다. 
또한 SLAM은 너무 빨리 이동하거나 너무 멀리 이동하는 검 스윙과 같이 VR에서 해당 움직임으로 올바르게 변환되지 않는 신체적 움직임으로 인해 발생할 수있는 혼란스러운 느낌인 "swimminess"을 최소화하는 등의 미묘한 이점을 가지고 있습니다. .

**모션 캡처 및 장치 시뮬레이션을 통한 정확성 향상**

이러한 광범위한 잠재적 문제를 해결하고 소비자 시장에 충분한 제품으로 시스템을 구축한다는 것은 비슷한 기술적 과제를 해결하는 것을 의미했습니다. 정확성과 효율성이라는 두 가지 목표와 관련된 목표가 대부분입니다.

지터(jitter)를 줄이기 위해 달성 한 서브 밀리미터 수준의 정밀도와 같이 정확도의 일부 측정은 쉽게 정량화 할 수 있습니다. 그러나 swimmness과 같은 다른 경험은 사용자의 주관적인 관점에 부분적으로 기초합니다. 테니스 라켓 스윙은 너무 빠르거나 너무 멀리 이동하는 것처럼 보일 수 있지만 외부 센서 기반 측정은 반드시 오류로 생각할 필요는 없습니다. 물리적 움직임과 VR 움직임 사이의 격차를 정량화하고 궁극적으로 마무리하는 것은 이러한 불일치를 측정하는 새로운 접근법이 필요했습니다.

우리의 솔루션은 OptiTrack 카메라 배열에 의해 수집 된 외부 모션 캡처의 데이터에 대해 측정 된 센서 데이터의 광범위한 분석이었습니다. Hollywood VFX 제작에 사용 된 것과 유사하게 본 카메라는 직원의 실제 집안과 Facebook 작업 공간에 배치되었습니다. OptiTrack 시스템은 참가자의 HMD 및 컨트롤러와 각 테스트 환경에서 배치 된 LED를 추적합니다. 이를 통해 Quest 및 Rift S 사용자의 정확한 3D 위치를 계산 한 다음 해당 측정치를 Oculus Insight의 위치 추적 알고리즘이 생각했던 위치와 비교할 수 있었습니다. 그런 다음 모션 캡처 및 위치 데이터의 잠재적 불일치에 따라 알고리즘을 조정하여 다양한 조명, 장식 및 실내 크기를 특징으로하는 수백 가지 환경에서 테스트하여 시스템을 개선함으로써 Oculus Insight의 정확성에 영향을 줄 수 있었습니다.

이러한 물리적 테스트 환경을 사용하는 것 외에도 수천 시간의 녹화 된 비디오 데이터를 재생하고 지정된 비디오 시퀀스를 보면서 시스템 성능의 변경 사항을 표시하는 자동화 시스템도 개발했습니다. 또한 Quest는 모바일 칩셋을 사용하기 때문에 Facebook 데이터 센터의 시스템과 같은 일반 서버 컴퓨터에서 실행하는 동안 모바일 장치의 성능을 시뮬레이션하는 모델을 구축했습니다. 이를 통해 Quest의 실제 성능을 대표하는 결과로 대규모 재생을 수행 할 수 있었으며 운영해야하는 HMD의 제약 내에서 Insight의 알고리즘을 개선했습니다.

**매우 효율적인 장치 최적화 CV 설계**

정확성은 Insight의 위치 추적에 중요하지만 전례없는 수준의 CV 효율성이 필요했습니다. Oculus Quest는 PC 또는 콘솔 게임보다 전력을 2 배 적게 소비하는 컴퓨팅 시스템에서 PC 및 콘솔 게임과 비교할 수있는 해상도 및 프레임 속도로 실시간 고급 그래픽을 렌더링합니다. . 동시에 실시간 SLAM 및 컨트롤러 추적 시스템도 실행합니다. 이 모든 것을 현대의 PC보다 적은 컴퓨팅 파워, 2 배 적은 총 파워 및 실질적으로 적은 메모리 대역폭으로 실행하는 것은 중요한 시스템 과제였습니다.

이 컴퓨팅 파이프 라인을 간소화하는 단일 접근 방식이 아니라 장치에서 실행되도록 설계된 다양한 다중 스레드 조정이 있었으며 많은 작업이 비동기식으로 발생했습니다.

![Oculus Insight 아키텍쳐](https://scontent-icn1-1.xx.fbcdn.net/v/t39.2365-6/69529389_523449391745477_1355053656377917440_n.png?_nc_cat=110&_nc_oc=AQmwt-PLiE09lCYGAmHeN4LnAU3JJsDg1FRBj2exsC0m4ETLsqpwb5rSo0mjoAcFQR4&_nc_ht=scontent-icn1-1.xx&oh=fdd032ddeb823b17497e83970c4f62a8&oe=5E0A7D00)

예를 들어, 비동기 맵 업데이트를 포함하는 Quest에 맞추어진 디지털 신호 처리 (DSP) 최적화를 사용하여 시스템이 사용자 환경의 변화에 ​​따라 백그라운드에서 맵을 세분화하고 업데이트 할 수 있습니다. 한편, IMU 데이터는 시스템 대기 시간을 최소화하기 위해 공유 메모리 버퍼에 저장된 출력과 함께 우선 순위가 높은 자체 스레드에서 실행됩니다.

**공간 AI(Spatial-AI)의 미래**

Oculus Insight는 AR 및 VR의 새로운 무선 기술을 위한 토대이며, Quest 사용자에게 완전 무선 상의 전력 및 계산 효율성을 제공하여 실제 장애물을 피하면서 자신이 설정 한 재생 공간 경계 내에 유지할 수 있도록 합니다. 이 연구는 SLAM을 연구하는 연구원 뿐만 아니라 디지털 어시스턴트 및 물리적 로봇과 같이 리소스가 적고 고 정확한 룸 매핑의 혜택을받는 모든 시스템에 광범위하게 적용될 수 있습니다.

이 추적 시스템은 또한 공간 AI 기술을 Facebook이 구축하는 모든 연결된 장치 및 플랫폼에 통합하려는 장기 비전의 일부입니다. 지금까지 공간 AI 응용 프로그램에는 소비자 응용 프로그램에서 이러한 접근 방식이 가능함을 보여주는 Oculus Insight와 Facebook Reality Labs가 연구 지향 복제본 데이터 세트를 위해 만든 사실적인 3D 재구성이 포함되어 있습니다. 그러나이 기술의 미래는 공간적으로 인식되는 하루 종일 착용 가능한 AR 안경에 있습니다. 이를 위해서는 대기 시간을 더욱 줄이고 전력 소비를 HMD에서 SLAM에 필요한 것의 2 %까지 줄일 수있는 등 더 큰 제약 조건으로 SLAM을 실행해야합니다. 이러한 문제를 해결하려면 여러 센서 입력을 합성하는 프로세스를 더욱 최적화하기 위해 하드웨어 혁신과 AI 개발이 필요합니다. 이 작업의 궁극적 인 목표는 몰입감이 뛰어나고 물리적 세계에 통합 된 AR 및 VR 경험을 제공하는 것입니다.

Authors

- Joel Hesch(Engineering Manager)
- Anna Kozminksi(Software Program Manager)
- Oskar Linde(Lead Machine Perception Architect)